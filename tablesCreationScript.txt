  -- Table: simulator

-- DROP TABLE simulator;
insert into simulator (simulatorname, hostname, port) values ('boeing', 'pcrydlo.fit.vutbr.cz', 12322);

CREATE TABLE simulator
(
  SimulatorId serial NOT NULL,
  SimulatorName character varying(255) NOT NULL,
  Hostname character varying(255) NOT NULL,
  Port int NOT NULL,
  AircraftModel character varying(255),
  MinSpeed integer,
  MaxSpeed integer,
  HighSpeed integer,
  MaxSpeedOnFlaps integer,
  MinSpeedOnFlaps integer,
  HasGears boolean,
  MinTempCHT1 real,
  MinTempCHT2 real,
  MinTempEGT1 real,
  MinTempEGT2 real,
  MaxTempCHT1 real,
  MaxTempCHT2 real,
  MaxTempEGT1 real,
  MaxTempEGT2 real,
  ManifoldPressure integer,
  Power integer,
  MaxAmountOfFuel real,
  MinAmountOfFuel real,
  MaxRPM integer,
  NumberOfEngines integer,
  "timestamp" timestamp without time zone DEFAULT now(),
  CONSTRAINT simulator_pkey PRIMARY KEY (SimulatorId),
  CONSTRAINT simulator_SimulatorName_key UNIQUE (SimulatorName)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE simulator
  OWNER TO postgres;



CREATE TABLE simulation
(
  SimulationId serial NOT NULL,
  Simulator_SimulatorId integer NOT NULL,
  IsSimulationOn boolean,
  IsSimulationPaused boolean,
  SimulationStartedTime timestamp without time zone,
  SimulationEndedTime timestamp without time zone,
  "timestamp" timestamp without time zone DEFAULT now(),
  CONSTRAINT simulation_pkey PRIMARY KEY (SimulationId),
  CONSTRAINT simulation_Simulator_SimulatorId_fkey FOREIGN KEY (Simulator_SimulatorId)
      REFERENCES simulator (SimulatorId) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION
);



  
  -- Table: simulationdevicesstate

-- DROP TABLE simulationdevicesstate;

CREATE TABLE simulationdevicesstate
(
  DevStateId serial NOT NULL,
  Simulation_SimulationId integer NOT NULL,
  Elevator double precision,
  Eleron double precision,
  Rudder integer,
  Throttle double precision,
  Flaps integer,
  SpeedBrakes double precision,
  "trim" double precision,
  "timestamp" timestamp without time zone DEFAULT now(),
  CONSTRAINT simulationdevicesstate_pkey PRIMARY KEY (DevStateId),
  CONSTRAINT simulationdevicesstate_Simulation_SimulationId_fkey FOREIGN KEY (Simulation_SimulationId)
      REFERENCES simulation (SimulationId) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION
)
WITH (
  OIDS=FALSE
);
ALTER TABLE simulationdevicesstate
  OWNER TO postgres;
  
  
  
  -- Table: simulationpfdinfo

-- DROP TABLE simulationpfdinfo;

CREATE TABLE simulationpfdinfo
(
  PFDInfoId serial NOT NULL,
  Simulation_SimulationId integer NOT NULL,
  Roll double precision,
  Pitch double precision,
  Heading double precision,
  TrueCourse double precision,
  IAS double precision,
  Altitude double precision,
  GroundAltitude double precision,
  VerticalSpeed double precision,
  "timestamp" timestamp without time zone DEFAULT now(),
  CONSTRAINT simulationpfdinfo_pkey PRIMARY KEY (PFDInfoId),
  CONSTRAINT simulationpfdinfo_Simulation_SimulationId_fkey FOREIGN KEY (Simulation_SimulationId)
      REFERENCES simulation (SimulationId) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION
)
WITH (
  OIDS=FALSE
);
ALTER TABLE simulationpfdinfo
  OWNER TO postgres;


  CREATE TABLE SimulationInfo (
  SimulationInfoId serial   NOT NULL ,
  Simulation_SimulationId INTEGER   NOT NULL ,
  Longtitude double precision    ,
  Latitude double precision    ,
  "timestamp" TIMESTAMP default now() ,
PRIMARY KEY(SimulationInfoId)  ,
  FOREIGN KEY(Simulation_SimulationId)
    REFERENCES Simulation(SimulationId));

  
  

  
  
  
SELECT *
FROM SimulationInfo si1
WHERE Simulation_SimulationId=(SELECT SimulationId 
				FROM simulation 
				WHERE Simulator_SimulatorId=1
				AND IsSimulationOn=true 
				ORDER BY SimulationStartedTime DESC LIMIT 1) 
AND NOT EXISTS (
				SELECT si2.SimulationInfoId
				FROM SimulationInfo si2 
				WHERE si1.Longtitude=si2.Longtitude 
				AND si1.Latitude=si2.Latitude
				AND si1.BrakesOn=si2.BrakesOn
				AND si1.FlapsOn=si2.FlapsOn
				AND si1.SimulationInfoId=(si2.SimulationInfoId - 1 ))
ORDER BY Timestamp ASC;

delete from simulation;
delete from simulationdevicesstate
delete from simulationinfo
delete from simulationpfdinfo

drop table simulationinfo;
drop table simulationpfdinfo;
drop table simulationdevicesstate;
select * from simulator;
select * from simulation;
select * from simulationinfo;
select * from simulationdevicesstate;
select * from simulationpfdinfo;

insert into simulation (simulator_simulatorid, issimulationon, issimulationpaused)
values (2, true, true);

INSERT INTO simulation (simulator_simulatorid, issimulationon, issimulationpaused, simulationsstartedtime, simulationendedtime) VALUES ( 1, 'true', 'false',  now()  now() )

 insert into SimulationPFDInfo (Simulation_SimulationId, Roll, Pitch, IAS, Altitude, GroundAltitude, VerticalSpeed, Heading, Truecourse) 
VALUES (1,-30, 350, 5, 200, 2000, 1800, 30, 20);
select * from SimulationPFDInfo;

insert into simulationinfo(simulation_simulationid, longtitude, latitude) 
values (1, 20, 20);

update simulation 
set IsSimulationOn=true, IsSimulationPaused=true
where simulator_simulatorid=2;

SELECT count(DISTINCT Simulator_SimulatorId) FROM simulation WHERE Simulator_SimulatorId=1
